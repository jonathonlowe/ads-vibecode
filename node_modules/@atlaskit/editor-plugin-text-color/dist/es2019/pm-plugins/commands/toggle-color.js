import { removeMark, toggleMark } from '@atlaskit/editor-common/mark';
import { ACTIONS, pluginKey } from '../main';
import { overrideMarks } from '../utils/constants';
import { getDisabledState } from '../utils/disabled';
export const toggleColor = color => (state, dispatch) => {
  const {
    textColor
  } = state.schema.marks;
  const tr = state.tr;
  const disabledState = getDisabledState(state);
  if (disabledState) {
    if (dispatch) {
      dispatch(tr.setMeta(pluginKey, {
        action: ACTIONS.DISABLE
      }));
    }
    return false;
  }
  if (dispatch) {
    overrideMarks.forEach(mark => {
      const {
        marks
      } = tr.doc.type.schema;
      if (marks[mark]) {
        removeMark(marks[mark])({
          tr
        });
      }
    });
    toggleMark(textColor, {
      color
    })({
      tr
    });
    dispatch(tr);
  }
  return true;
};