"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.toggleColor = void 0;
var _mark = require("@atlaskit/editor-common/mark");
var _main = require("../main");
var _constants = require("../utils/constants");
var _disabled = require("../utils/disabled");
var toggleColor = exports.toggleColor = function toggleColor(color) {
  return function (state, dispatch) {
    var textColor = state.schema.marks.textColor;
    var tr = state.tr;
    var disabledState = (0, _disabled.getDisabledState)(state);
    if (disabledState) {
      if (dispatch) {
        dispatch(tr.setMeta(_main.pluginKey, {
          action: _main.ACTIONS.DISABLE
        }));
      }
      return false;
    }
    if (dispatch) {
      _constants.overrideMarks.forEach(function (mark) {
        var marks = tr.doc.type.schema.marks;
        if (marks[mark]) {
          (0, _mark.removeMark)(marks[mark])({
            tr: tr
          });
        }
      });
      (0, _mark.toggleMark)(textColor, {
        color: color
      })({
        tr: tr
      });
      dispatch(tr);
    }
    return true;
  };
};