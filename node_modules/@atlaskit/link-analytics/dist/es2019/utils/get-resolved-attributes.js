import { getStatus } from '@atlaskit/linking-common';
import { getDisplayCategory } from './get-display-category';
import { fg } from '@atlaskit/platform-feature-flags';

/**
 * Returns a set of analytics attributes that be
 * derived from a JSON.LD response
 */
export const getResolvedAttributes = (linkDetails, details, linkStatus, error) => {
  var _details$meta$request, _details$meta, _details$meta$request2, _ref, _details$meta$key, _details$meta2, _details$meta$key2, _details$meta3, _details$meta$tenantI, _details$meta4, _details$meta$activat, _details$meta5, _details$meta$contain, _details$meta6, _details$meta$categor, _details$meta7, _details$meta$product, _details$meta8, _details$meta$subprod, _details$meta9, _details$meta$objectI, _details$meta10, _details$meta$resourc, _details$meta11;
  const status = linkStatus !== null && linkStatus !== void 0 ? linkStatus : details && getStatus(details);
  const displayCategory = linkDetails.displayCategory === 'link' ? 'link' : getDisplayCategory(status);
  return {
    status: status !== null && status !== void 0 ? status : null,
    statusDetails: (_details$meta$request = details === null || details === void 0 ? void 0 : (_details$meta = details.meta) === null || _details$meta === void 0 ? void 0 : (_details$meta$request2 = _details$meta.requestAccess) === null || _details$meta$request2 === void 0 ? void 0 : _details$meta$request2.accessType) !== null && _details$meta$request !== void 0 ? _details$meta$request : null,
    displayCategory,
    extensionKey: fg('platform_bandicoots-smartlink-unresolved-error-key') ? (_ref = (_details$meta$key = details === null || details === void 0 ? void 0 : (_details$meta2 = details.meta) === null || _details$meta2 === void 0 ? void 0 : _details$meta2.key) !== null && _details$meta$key !== void 0 ? _details$meta$key : error === null || error === void 0 ? void 0 : error.extensionKey) !== null && _ref !== void 0 ? _ref : null : (_details$meta$key2 = details === null || details === void 0 ? void 0 : (_details$meta3 = details.meta) === null || _details$meta3 === void 0 ? void 0 : _details$meta3.key) !== null && _details$meta$key2 !== void 0 ? _details$meta$key2 : null,
    destinationTenantId: (_details$meta$tenantI = details === null || details === void 0 ? void 0 : (_details$meta4 = details.meta) === null || _details$meta4 === void 0 ? void 0 : _details$meta4.tenantId) !== null && _details$meta$tenantI !== void 0 ? _details$meta$tenantI : null,
    destinationActivationId: (_details$meta$activat = details === null || details === void 0 ? void 0 : (_details$meta5 = details.meta) === null || _details$meta5 === void 0 ? void 0 : _details$meta5.activationId) !== null && _details$meta$activat !== void 0 ? _details$meta$activat : null,
    destinationContainerId: (_details$meta$contain = details === null || details === void 0 ? void 0 : (_details$meta6 = details.meta) === null || _details$meta6 === void 0 ? void 0 : _details$meta6.containerId) !== null && _details$meta$contain !== void 0 ? _details$meta$contain : null,
    destinationCategory: (_details$meta$categor = details === null || details === void 0 ? void 0 : (_details$meta7 = details.meta) === null || _details$meta7 === void 0 ? void 0 : _details$meta7.category) !== null && _details$meta$categor !== void 0 ? _details$meta$categor : null,
    destinationProduct: (_details$meta$product = details === null || details === void 0 ? void 0 : (_details$meta8 = details.meta) === null || _details$meta8 === void 0 ? void 0 : _details$meta8.product) !== null && _details$meta$product !== void 0 ? _details$meta$product : null,
    destinationSubproduct: (_details$meta$subprod = details === null || details === void 0 ? void 0 : (_details$meta9 = details.meta) === null || _details$meta9 === void 0 ? void 0 : _details$meta9.subproduct) !== null && _details$meta$subprod !== void 0 ? _details$meta$subprod : null,
    destinationObjectId: (_details$meta$objectI = details === null || details === void 0 ? void 0 : (_details$meta10 = details.meta) === null || _details$meta10 === void 0 ? void 0 : _details$meta10.objectId) !== null && _details$meta$objectI !== void 0 ? _details$meta$objectI : null,
    destinationObjectType: (_details$meta$resourc = details === null || details === void 0 ? void 0 : (_details$meta11 = details.meta) === null || _details$meta11 === void 0 ? void 0 : _details$meta11.resourceType) !== null && _details$meta$resourc !== void 0 ? _details$meta$resourc : null,
    canBeDatasource: ((details === null || details === void 0 ? void 0 : details.datasources) || []).length > 0
  };
};