"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getDateInformation = void 0;
var _utils = require("@atlaskit/editor-common/utils");
var getDateInformation = exports.getDateInformation = function getDateInformation(timestamp, intl, state, pos) {
  if (!state) {
    return {
      color: undefined,
      displayString: (0, _utils.timestampToString)(timestamp, intl)
    };
  }
  var doc = state.doc,
    selection = state.selection;
  var taskItem = state.schema.nodes.taskItem;

  // We fall back to selection.$from even though it does not cover all use cases
  // eg. upon Editor init, selection is at the start, not at the Date node
  var $nodePos = typeof pos === 'number' ? doc.resolve(pos) : selection.$from;
  var parent = $nodePos.parent;
  var withinIncompleteTask = parent.type === taskItem && parent.attrs.state !== 'DONE';
  var color = withinIncompleteTask && (0, _utils.isPastDate)(timestamp) ? 'red' : undefined;
  var displayString = withinIncompleteTask ? (0, _utils.timestampToTaskContext)(timestamp, intl) : (0, _utils.timestampToString)(timestamp, intl);
  return {
    displayString: displayString,
    color: color
  };
};