import { SafePlugin } from '@atlaskit/editor-common/safe-plugin';
import { pluginKey } from './plugin-key';
export function createPlugin(dispatch) {
  return new SafePlugin({
    key: pluginKey,
    state: {
      init: () => ({
        width: document.body.offsetWidth
      }),
      apply(tr, pluginState) {
        const meta = tr.getMeta(pluginKey);
        if (!meta) {
          return pluginState;
        }
        const newPluginState = {
          ...pluginState,
          ...meta
        };
        if (newPluginState && (pluginState.width !== newPluginState.width || pluginState.lineLength !== newPluginState.lineLength)) {
          dispatch(pluginKey, newPluginState);
          return newPluginState;
        }
        return pluginState;
      }
    }
  });
}