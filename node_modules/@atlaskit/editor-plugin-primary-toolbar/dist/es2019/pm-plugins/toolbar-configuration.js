import { fg } from '@atlaskit/platform-feature-flags';
import { editorExperiment } from '@atlaskit/tmp-editor-statsig/experiments';
export const getToolbarComponents = ({
  componentRegistry,
  editorState,
  contextualFormattingEnabled
}) => {
  let configuration;
  if (contextualFormattingEnabled && editorExperiment('platform_editor_controls', 'variant1', {
    exposure: true
  })) {
    const shouldShowInsertBlock = fg('platform_editor_insert_button_on_primary_toolbar');
    const shouldShowUndoRedoFindGroup = fg('platform_editor_controls_move_actions');
    configuration = toolbarConfigurationV2(shouldShowInsertBlock, shouldShowUndoRedoFindGroup);
  } else {
    configuration = toolbarConfiguration;
  }
  return configuration.filter(toolbarElement => typeof toolbarElement.enabled === 'undefined' || toolbarElement.enabled(componentRegistry, editorState)).reduce((acc, toolbarElement) => {
    if (componentRegistry.has(toolbarElement.name)) {
      const component = componentRegistry.get(toolbarElement.name);
      if (!!component) {
        acc.push(component);
      }
    }
    return acc;
  }, []);
};
const undoRedoGroup = [{
  name: 'undoRedoPlugin'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('undoRedoPlugin')
}];
const spellCheckGroup = [{
  name: 'spellCheck'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('spellCheck')
}];
const blockTypeGroup = [{
  name: 'blockType'
}, {
  name: 'separator',
  enabled: (componentRegistry, editorState) => componentRegistry.has('blockType') &&
  // Use case where you want to have the block plugin but not render any toolbar items (when you exclude headings), we should be able to get rid of this when we split block type plugin up and check for the presence of the heading plugin directly
  !!editorState.schema.nodes.heading
}];
const textFormattingGroup = [{
  name: 'textFormatting'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('textFormatting')
}];
const alignmentGroup = [{
  name: 'alignment'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('alignment')
}];
const textColorGroup = [{
  name: 'textColor'
}, {
  name: 'highlight'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('textColor') || componentRegistry.has('highlight')
}];
const listFormattingGroup = [{
  name: 'toolbarListsIndentation'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('toolbarListsIndentation')
}];
const hyperlinkGroup = [{
  name: 'hyperlink'
}, {
  name: 'separator',
  enabled: componentRegistry => componentRegistry.has('hyperlink')
}];
const insertBlockGroup = [{
  name: 'insertBlock'
}];
const others = [{
  name: 'beforePrimaryToolbar'
}, {
  name: 'avatarGroup'
}, {
  name: 'findReplace'
}, {
  // TODO: ED-26962 - Should likely be split into three: spelling & grammar, separator, and AI trigger
  name: 'aiExperience'
}, {
  name: 'loom'
}];
const findGroup = [{
  name: 'findReplace'
}];
const toolbarConfiguration = [...undoRedoGroup, ...spellCheckGroup, ...blockTypeGroup, ...textFormattingGroup, ...alignmentGroup, ...textColorGroup, ...listFormattingGroup, ...insertBlockGroup, ...others];
const toolbarConfigurationV2 = (shouldShowInsertBlock = false, shouldShowMoveActions = false) => [...(shouldShowMoveActions ? undoRedoGroup : []), ...blockTypeGroup, ...textFormattingGroup, ...textColorGroup, ...alignmentGroup, ...listFormattingGroup, ...hyperlinkGroup, ...(shouldShowInsertBlock ? insertBlockGroup : []), {
  name: 'overflowMenu'
}, {
  name: 'beforePrimaryToolbar'
}, ...(shouldShowMoveActions ? findGroup : [])];