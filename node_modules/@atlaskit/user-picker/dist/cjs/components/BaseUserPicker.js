"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BaseUserPickerWithoutAnalytics = exports.BaseUserPicker = void 0;
var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));
var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));
var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));
var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
var _analyticsNext = require("@atlaskit/analytics-next");
var _ufo = require("@atlaskit/ufo");
var _debounce = _interopRequireDefault(require("lodash/debounce"));
var _react = _interopRequireDefault(require("react"));
var _reactIntlNext = require("react-intl-next");
var _platformFeatureFlags = require("@atlaskit/platform-feature-flags");
var _uuid = require("uuid");
var _analytics = require("../analytics");
var _batch = require("./batch");
var _i18n = require("./i18n");
var _utils = require("./utils");
var _ufoExperiences = require("../util/ufoExperiences");
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t.return || t.return(); } finally { if (u) throw o; } } }; }
function _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }
function _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }
function _callSuper(t, o, e) { return o = (0, _getPrototypeOf2.default)(o), (0, _possibleConstructorReturn2.default)(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], (0, _getPrototypeOf2.default)(t).constructor) : o.apply(t, e)); }
function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }
var loadingMessage = function loadingMessage() {
  return null;
};
var classNamePrefix = 'fabric-user-picker';
var BaseUserPickerWithoutAnalytics = exports.BaseUserPickerWithoutAnalytics = /*#__PURE__*/function (_React$Component) {
  function BaseUserPickerWithoutAnalytics(props) {
    var _this;
    (0, _classCallCheck2.default)(this, BaseUserPickerWithoutAnalytics);
    _this = _callSuper(this, BaseUserPickerWithoutAnalytics, [props]);
    (0, _defineProperty2.default)(_this, "getSessionId", function () {
      return _this.session && _this.session.id ? _this.session.id : undefined;
    });
    (0, _defineProperty2.default)(_this, "withSelectRef", function (callback) {
      return function () {
        if (_this.selectRef) {
          callback(_this.selectRef);
        }
      };
    });
    (0, _defineProperty2.default)(_this, "nextOption", _this.withSelectRef(function (select) {
      return select.focusOption('down');
    }));
    (0, _defineProperty2.default)(_this, "previousOption", _this.withSelectRef(function (select) {
      return select.focusOption('up');
    }));
    (0, _defineProperty2.default)(_this, "focus", function () {
      if (_this.selectRef && _this.selectRef.focus) {
        _this.selectRef.focus();
      }
    });
    (0, _defineProperty2.default)(_this, "blur", function () {
      if (_this.selectRef && _this.selectRef.blur) {
        _this.selectRef.blur();
      }
    });
    (0, _defineProperty2.default)(_this, "selectOption", _this.withSelectRef(function (select) {
      var focusedOption = select.state.focusedOption;
      select.selectOption(focusedOption);
    }));
    // value = null if user deletes the last item in the user picker
    (0, _defineProperty2.default)(_this, "handleChange", function (value, _ref) {
      var action = _ref.action,
        removedValue = _ref.removedValue,
        option = _ref.option;
      if (removedValue && removedValue.data.fixed) {
        return;
      }
      _this.resetInputState();
      var _this$props = _this.props,
        onChange = _this$props.onChange,
        onSelection = _this$props.onSelection,
        onClear = _this$props.onClear,
        isMulti = _this$props.isMulti;
      (0, _utils.callCallback)(onChange, (0, _utils.extractOptionValue)(value), action);
      switch (action) {
        case 'select-option':
          if (value) {
            (0, _utils.callCallback)(onSelection, (0, _utils.extractOptionValue)(value), _this.getSessionId(), _this);
          }
          _this.fireEvent(_analytics.selectEvent, isMulti ? option : value);
          _this.session = isMulti ? (0, _analytics.startSession)() : undefined;
          break;
        case 'clear':
          (0, _utils.callCallback)(onClear);
          _this.fireEvent(_analytics.clearEvent);
          break;
        case 'remove-value':
        case 'pop-value':
          if (removedValue) {
            _this.fireEvent(_analytics.deleteEvent, removedValue.data);
          }
          break;
      }
      _this.fireEvent(_analytics.searchedEvent);
      if (removedValue && _this.state.value && Array.isArray(_this.state.value)) {
        var remainingValues = _this.state.value.filter(function (val) {
          return val.data.id !== removedValue.data.id;
        });
        _this.setState({
          value: remainingValues ? remainingValues : [],
          menuIsOpen: true
        });
      }
      if (!_this.props.value) {
        _this.setState({
          value: value ? value : []
        });
      }
    });
    (0, _defineProperty2.default)(_this, "handleSelectRef", function (ref) {
      _this.selectRef = ref;
    });
    (0, _defineProperty2.default)(_this, "addOptions", (0, _batch.batchByKey)(function (request, newOptions) {
      var resolving = _this.state.resolving;
      _this.setState(function (_ref2) {
        var inflightRequest = _ref2.inflightRequest,
          options = _ref2.options,
          count = _ref2.count;
        if (inflightRequest.toString() === request) {
          return {
            options: (resolving ? options : []).concat(newOptions.reduce(function (nextOptions, item) {
              return Array.isArray(item) ? nextOptions.concat(item[0]) : nextOptions.concat(item);
            }, [])),
            count: count - newOptions.length,
            resolving: count - newOptions.length !== 0
          };
        }
        return null;
      });
    }));
    (0, _defineProperty2.default)(_this, "handleLoadOptionsError", function () {
      var count = _this.state.count;
      var newCount = count - 1;
      var resolving = newCount !== 0;
      var showError = false;
      if (!resolving) {
        showError = true;
      }
      _this.setState({
        count: newCount,
        resolving: resolving,
        showError: showError
      });
      _this.fireEvent(_analytics.failedEvent);
    });
    (0, _defineProperty2.default)(_this, "debouncedLoadOptions", (0, _debounce.default)(function (search) {
      var loadOptions = _this.props.loadOptions;
      if (loadOptions) {
        var inflightRequest = _this.state.inflightRequest + 1;
        var result = _this.session && _this.session.id ? loadOptions(search, _this.session.id) : loadOptions(search);
        var addOptions = _this.addOptions.bind(_this, inflightRequest.toString());
        var count = 0;
        if ((0, _utils.isIterable)(result)) {
          var _iterator = _createForOfIteratorHelper(result),
            _step;
          try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              var _value = _step.value;
              Promise.resolve(_value).then(addOptions).catch(_this.handleLoadOptionsError);
              count++;
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }
        } else {
          Promise.resolve(result).then(addOptions).catch(_this.handleLoadOptionsError);
          count++;
        }
        _this.setState({
          inflightRequest: inflightRequest,
          count: count,
          resolving: count !== 0,
          options: []
        });
      }
    }, 200));
    (0, _defineProperty2.default)(_this, "abortOptionsShownUfoExperience", function () {
      if (_this.optionsShownUfoExperienceInstance.state.id === _ufo.UFOExperienceState.STARTED.id) {
        // There may be an existing UFO timing running from previous key entry or focus,
        // so abort it and restart it just in case.
        _this.optionsShownUfoExperienceInstance.abort();
      }
    });
    (0, _defineProperty2.default)(_this, "startOptionsShownUfoExperience", function () {
      _this.abortOptionsShownUfoExperience();
      _this.optionsShownUfoExperienceInstance.start();
    });
    (0, _defineProperty2.default)(_this, "executeLoadOptions", function (search) {
      var loadOptions = _this.props.loadOptions;
      if (loadOptions) {
        _this.setState({
          resolving: true,
          showError: false
        }, function () {
          return _this.debouncedLoadOptions(search);
        });
      }
    });
    (0, _defineProperty2.default)(_this, "handleFocus", function (event) {
      var _this$state = _this.state,
        value = _this$state.value,
        menuIsOpen = _this$state.menuIsOpen;
      if (!menuIsOpen || !_this.session) {
        _this.startSession();
      }
      _this.startOptionsShownUfoExperience();
      (0, _utils.callCallback)(_this.props.onFocus, _this.getSessionId());
      if (!_this.isMenuOpenOnClickForSingleSelect) {
        _this.setState({
          menuIsOpen: true
        });
        if (!_this.props.isMulti && (0, _utils.isSingleValue)(value)) {
          var input = event.target;
          _this.setState({
            inputValue: value.label
          }, function () {
            if (input instanceof HTMLInputElement) {
              input.setSelectionRange(0, value.label.length);
            }
          });
        }
      }
    });
    (0, _defineProperty2.default)(_this, "resetInputState", function () {
      // Prevent filter if query typed, then blurred with no selection
      _this.setState({
        inputValue: ''
      });
      (0, _utils.callCallback)(_this.props.onInputChange, '', _this.getSessionId());
    });
    (0, _defineProperty2.default)(_this, "handleBlur", function () {
      (0, _utils.callCallback)(_this.props.onBlur, _this.getSessionId());
      if ((0, _utils.isPopupUserPickerByComponent)(_this.props.SelectComponent)) {
        return;
      }
      _this.resetInputState();
      _this.abortOptionsShownUfoExperience();
      _this.setState({
        menuIsOpen: false,
        initialFocusHandled: false,
        options: []
      });
    });
    (0, _defineProperty2.default)(_this, "handleOpen", function () {
      (0, _utils.callCallback)(_this.props.onOpen, _this.getSessionId());
      _this.setState({
        menuIsOpen: true
      });
    });
    (0, _defineProperty2.default)(_this, "handleClose", function () {
      _this.resetInputState();
      (0, _utils.callCallback)(_this.props.onClose, _this.getSessionId());
      _this.setState({
        menuIsOpen: false,
        options: []
      });
    });
    (0, _defineProperty2.default)(_this, "handleInputChange", function (search, _ref3) {
      var action = _ref3.action;
      if (action === 'input-change' || action === 'set-value') {
        (0, _utils.callCallback)(_this.props.onInputChange, search, _this.getSessionId());
        _this.setState({
          inputValue: search
        });
        _this.startOptionsShownUfoExperience();
      }
    });
    (0, _defineProperty2.default)(_this, "fireEvent", function (eventCreator) {
      var createAnalyticsEvent = _this.props.createAnalyticsEvent;
      if (createAnalyticsEvent) {
        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
          args[_key - 1] = arguments[_key];
        }
        (0, _analytics.createAndFireEventInElementsChannel)(eventCreator.apply(void 0, [_this.props, _this.state, _this.session, _this.journeyId].concat(args)))(createAnalyticsEvent);
      }
    });
    (0, _defineProperty2.default)(_this, "startSession", function () {
      _this.session = (0, _analytics.startSession)();
      _this.journeyId = _this.getSessionId();
      _this.fireEvent(_analytics.focusEvent);
    });
    (0, _defineProperty2.default)(_this, "handleKeyDown", function (event) {
      if (!_this.isMenuOpenOnClickForSingleSelect) {
        // Escape
        if (event.keyCode === 27) {
          _this.blur();
        }

        // Space
        if (event.keyCode === 32 && !_this.state.inputValue) {
          event.preventDefault();
          !_this.props.disableInput && _this.setState({
            inputValue: ' '
          });
        }
      }
      if (_this.session) {
        _this.session.lastKey = event.keyCode;
        switch (event.keyCode) {
          // KeyUp 38
          case 38:
            _this.session.upCount++;
            break;
          // KeyDown 40
          case 40:
            _this.session.downCount++;
            break;
        }
      }
      _this.props.onKeyDown && _this.props.onKeyDown(event);
    });
    (0, _defineProperty2.default)(_this, "handleClearIndicatorHover", function (hoveringClearIndicator) {
      _this.setState({
        hoveringClearIndicator: hoveringClearIndicator
      });
    });
    (0, _defineProperty2.default)(_this, "getOptions", function () {
      var options = (0, _utils.getOptions)(_this.state.options) || [];
      var _this$props2 = _this.props,
        maxOptions = _this$props2.maxOptions,
        isMulti = _this$props2.isMulti;
      if (maxOptions === 0) {
        return [];
      }
      if (maxOptions && maxOptions > 0 && maxOptions < options.length) {
        var _value2 = _this.state.value;
        var filteredOptions = options;
        // Filter out previously selected options
        if (isMulti && Array.isArray(_value2)) {
          var valueIds = _value2.map(function (item) {
            return item.data.id;
          });
          filteredOptions = options.filter(function (option) {
            return valueIds.indexOf(option.data.id) === -1;
          });
        }
        return filteredOptions.slice(0, maxOptions);
      }
      return options;
    });
    (0, _defineProperty2.default)(_this, "getAppearance", function () {
      return _this.props.appearance ? _this.props.appearance : 'normal';
    });
    (0, _defineProperty2.default)(_this, "handleClickDraggableParentComponent", function () {
      if (_this.state.initialFocusHandled) {
        // As <Select /> is already focused, calling this.selectRef.current.focus() again no longer triggers its own handlers (i.e. onMenuOpen, onMenuClose)
        // We have to manually handle the open and close states of the dropdown menu based on a user's click from this point onwards to prevent the bug
        if (_this.state.menuIsOpen) {
          _this.handleClose();
        } else {
          _this.handleOpen();
        }
        // escaping the below condition when openMenuOnClick is true otherwise menu own't open on click
      } else if (!_this.state.menuIsOpen && !_this.isMenuOpenOnClickForSingleSelect) {
        // Trigger focus state when ValueContainer is clicked for the first time
        // The focused state will then invoke <Select /> instance's own handlers (e.g. onMenuOpen, onMenuClose)
        // to manage the state of the dropdown menu
        _this.focus();
        _this.setState(function () {
          return {
            initialFocusHandled: true
          };
        });
      }
    });
    _this.state = {
      options: [],
      isDefaultSet: false,
      inflightRequest: 0,
      count: 0,
      hoveringClearIndicator: false,
      menuIsOpen: !!_this.props.open,
      inputValue: props.search || '',
      resolving: false,
      showError: false,
      initialFocusHandled: false
    };
    _this.optionsShownUfoExperienceInstance = _ufoExperiences.userPickerOptionsShownUfoExperience.getInstance((0, _uuid.v4)());
    return _this;
  }
  (0, _inherits2.default)(BaseUserPickerWithoutAnalytics, _React$Component);
  return (0, _createClass2.default)(BaseUserPickerWithoutAnalytics, [{
    key: "isMenuOpenOnClickForSingleSelect",
    get: function get() {
      return this.props.openMenuOnClick && !this.props.isMulti;
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this$props3 = this.props,
        open = _this$props3.open,
        search = _this$props3.search;
      // load options when the picker open
      if (open) {
        if (!this.session) {
          this.startSession();
        }
        this.executeLoadOptions(search);
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(_, prevState) {
      var _this$state2 = this.state,
        menuIsOpen = _this$state2.menuIsOpen,
        options = _this$state2.options,
        resolving = _this$state2.resolving,
        count = _this$state2.count,
        inputValue = _this$state2.inputValue;

      // Create a new session when the menu is opened and there is no session
      if (menuIsOpen && !prevState.menuIsOpen && !this.session) {
        this.startSession();
      }

      // Load options when user picker opens or when input value changes
      if (menuIsOpen && !prevState.menuIsOpen || inputValue !== prevState.inputValue) {
        this.executeLoadOptions(inputValue);
      }
      if (!menuIsOpen && prevState.menuIsOpen && this.session) {
        this.fireEvent(_analytics.cancelEvent, prevState);
        this.session = undefined;
      }
      if (menuIsOpen && (!prevState.menuIsOpen && options.length > 0 || options.length !== prevState.options.length)) {
        this.fireEvent(_analytics.searchedEvent);
      }
      if (this.state.inputValue !== prevState.inputValue) {
        if (this.session) {
          this.session.inputChangeTime = Date.now();
        }
      }
      if (menuIsOpen && (!_.loadOptions || prevState.menuIsOpen) && count === 0 && !resolving && [_ufo.UFOExperienceState.STARTED.id, _ufo.UFOExperienceState.IN_PROGRESS.id].includes(this.optionsShownUfoExperienceInstance.state.id)) {
        this.optionsShownUfoExperienceInstance.success();
      }
    }
  }, {
    key: "ariaProps",
    get: function get() {
      var ariaLabels = Object.keys(this.props).filter(function (key) {
        return key.startsWith('aria-');
      });
      var props = _objectSpread({}, this.props);
      return ariaLabels.reduce(function (obj, key) {
        return _objectSpread(_objectSpread({}, obj), {}, (0, _defineProperty2.default)({}, key, props[key]));
      }, {});
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props4 = this.props,
        isMulti = _this$props4.isMulti,
        isLoading = _this$props4.isLoading,
        subtle = _this$props4.subtle,
        noBorder = _this$props4.noBorder,
        placeholder = _this$props4.placeholder,
        isClearable = _this$props4.isClearable,
        isDisabled = _this$props4.isDisabled,
        isInvalid = _this$props4.isInvalid,
        clearValueLabel = _this$props4.clearValueLabel,
        menuMinWidth = _this$props4.menuMinWidth,
        menuPortalTarget = _this$props4.menuPortalTarget,
        loadOptionsErrorMessage = _this$props4.loadOptionsErrorMessage,
        addMoreMessage = _this$props4.addMoreMessage,
        noOptionsMessage = _this$props4.noOptionsMessage,
        footer = _this$props4.footer,
        disableInput = _this$props4.disableInput,
        components = _this$props4.components,
        pickerProps = _this$props4.pickerProps,
        SelectComponent = _this$props4.SelectComponent,
        styles = _this$props4.styles,
        autoFocus = _this$props4.autoFocus,
        fieldId = _this$props4.fieldId,
        inputId = _this$props4.inputId,
        maxPickerHeight = _this$props4.maxPickerHeight,
        textFieldBackgroundColor = _this$props4.textFieldBackgroundColor,
        ariaLabelledBy = _this$props4.ariaLabelledBy,
        ariaDescribedBy = _this$props4.ariaDescribedBy,
        ariaLive = _this$props4.ariaLive,
        ariaLabel = _this$props4.ariaLabel,
        name = _this$props4.name,
        header = _this$props4.header,
        required = _this$props4.required,
        UNSAFE_hasDraggableParentComponent = _this$props4.UNSAFE_hasDraggableParentComponent,
        placeholderAvatar = _this$props4.placeholderAvatar;
      var _this$state3 = this.state,
        count = _this$state3.count,
        hoveringClearIndicator = _this$state3.hoveringClearIndicator,
        menuIsOpen = _this$state3.menuIsOpen,
        value = _this$state3.value,
        inputValue = _this$state3.inputValue,
        resolving = _this$state3.resolving,
        showError = _this$state3.showError;
      var appearance = this.getAppearance();
      // these props override the default select menu open and close
      var menuOpenDeciderProps = _objectSpread({}, !this.isMenuOpenOnClickForSingleSelect && {
        menuIsOpen: menuIsOpen,
        blurInputOnSelect: !isMulti,
        openMenuOnFocus: true
      });
      return /*#__PURE__*/_react.default.createElement(SelectComponent, (0, _extends2.default)({
        name: name,
        value: value,
        autoFocus: autoFocus !== undefined ? autoFocus : menuIsOpen,
        "aria-labelledby": ariaLabelledBy,
        "aria-describedby": (0, _platformFeatureFlags.fg)('pass-aria-describedby-to-baseuserpicker') ? ariaDescribedBy : undefined,
        "aria-label": ariaLabel,
        "aria-live": ariaLive,
        "aria-required": required // This has been added as a safety net.
        ,
        required: required,
        ref: this.handleSelectRef,
        isMulti: isMulti,
        options: this.getOptions(),
        styles: styles,
        enableAnimation: isMulti,
        components: components,
        inputValue: inputValue,
        isLoading: count > 0 || resolving || isLoading,
        loadingMessage: loadingMessage,
        menuPlacement: "auto",
        placeholder: placeholder !== null && placeholder !== void 0 ? placeholder : /*#__PURE__*/_react.default.createElement(_reactIntlNext.FormattedMessage, _i18n.messages.placeholder),
        addMoreMessage: addMoreMessage,
        classNamePrefix: classNamePrefix,
        hoveringClearIndicator: hoveringClearIndicator,
        appearance: appearance,
        isClearable: isClearable,
        noBorder: noBorder,
        subtle: subtle,
        closeMenuOnSelect: !isMulti,
        noOptionsMessage: showError ? loadOptionsErrorMessage : typeof noOptionsMessage === 'function' ? noOptionsMessage : function () {
          return noOptionsMessage;
        },
        footer: footer,
        isDisabled: isDisabled,
        isInvalid: isInvalid,
        isFocused: menuIsOpen,
        backspaceRemovesValue: isMulti,
        filterOption: null // disable local filtering
        ,
        clearValueLabel: clearValueLabel,
        menuMinWidth: menuMinWidth,
        menuPortalTarget: menuPortalTarget,
        disableInput: disableInput || isDisabled,
        instanceId: fieldId,
        inputId: inputId,
        onChange: this.handleChange,
        onMenuOpen: this.handleOpen,
        onFocus: this.handleFocus,
        onBlur: this.handleBlur,
        onMenuClose: this.handleClose,
        onInputChange: this.handleInputChange,
        onClearIndicatorHover: this.handleClearIndicatorHover,
        onKeyDown: this.handleKeyDown,
        maxPickerHeight: maxPickerHeight,
        textFieldBackgroundColor: textFieldBackgroundColor,
        header: header,
        placeholderAvatar: placeholderAvatar
      }, this.ariaProps, pickerProps, UNSAFE_hasDraggableParentComponent && {
        onValueContainerClick: this.handleClickDraggableParentComponent
      }, menuOpenDeciderProps));
    }
  }], [{
    key: "getDerivedStateFromProps",
    value: function getDerivedStateFromProps(nextProps, prevState) {
      var derivedState = {};
      if (nextProps.isDisabled || nextProps.disableInput) {
        derivedState.menuIsOpen = false;
      }
      if (nextProps.open !== undefined) {
        derivedState.menuIsOpen = nextProps.open;
      }
      if (nextProps.value !== undefined) {
        derivedState.value = (0, _utils.optionToSelectableOptions)(nextProps.value);
      } else if ((0, _utils.isDefaultValuePopulated)(nextProps.defaultValue) && !prevState.isDefaultSet) {
        derivedState.value = (0, _utils.optionToSelectableOptions)(nextProps.defaultValue);
        derivedState.isDefaultSet = true;
      }
      if (nextProps.search !== undefined && nextProps.search !== prevState.inputValue) {
        derivedState.inputValue = nextProps.search;
      }
      if (nextProps.options !== undefined) {
        derivedState.options = nextProps.options;
      }
      return derivedState;
    }

    // session id for focus to blur
  }]);
}(_react.default.Component);
(0, _defineProperty2.default)(BaseUserPickerWithoutAnalytics, "defaultProps", {
  isMulti: false,
  subtle: false,
  noBorder: false,
  textFieldBackgroundColor: false,
  isClearable: true,
  loadOptionsErrorMessage: function loadOptionsErrorMessage() {
    return /*#__PURE__*/_react.default.createElement(_reactIntlNext.FormattedMessage, _i18n.messages.errorMessage);
  },
  openMenuOnClick: false
});
var BaseUserPicker = exports.BaseUserPicker = (0, _analyticsNext.withAnalyticsEvents)()(BaseUserPickerWithoutAnalytics);