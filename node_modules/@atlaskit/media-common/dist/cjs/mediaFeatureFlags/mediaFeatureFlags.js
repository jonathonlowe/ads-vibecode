"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getFeatureFlagKeysAllProducts = exports.filterFeatureFlagNames = exports.defaultMediaFeatureFlags = void 0;
exports.getMediaFeatureFlag = getMediaFeatureFlag;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _types = require("./types");
var _productKeys = require("./productKeys");
var _genericFeatureFlag = require("./genericFeatureFlag");
var filterFeatureFlagNames = exports.filterFeatureFlagNames = function filterFeatureFlagNames(flags) {
  var pairs = Object.entries(flags);
  return pairs.filter(function (_ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
      _key = _ref2[0],
      value = _ref2[1];
    return !!value;
  }).map(function (_ref3) {
    var _ref4 = (0, _slicedToArray2.default)(_ref3, 1),
      key = _ref4[0];
    return key;
  });
};

// TODO(MEX-1547): This is temporary solution to just return the launch darkly feature flags for all products.
/**
 * Takes a record of {Media Feature Flag Names â†’ boolean}.
 * Returns the Launch Darkly Keys from all products for each of the flags set as true in the input record.
 * */
var getFeatureFlagKeysAllProducts = exports.getFeatureFlagKeysAllProducts = function getFeatureFlagKeysAllProducts() {
  var productKeys = (0, _productKeys.getProductKeys)();
  var ldFeatureFlags = [];
  _types.supportedProducts.forEach(function (product) {
    ldFeatureFlags = [].concat((0, _toConsumableArray2.default)(ldFeatureFlags), (0, _toConsumableArray2.default)(Object.values(productKeys[product])));
  });
  return ldFeatureFlags.filter(function (flag) {
    return flag !== '';
  });
};

/**
 * defaultMediaFeatureFlags set default values used by the getter function getMediaFeatureFlag
 *
 * *************************************
 * ************* IMPORTANT *************
 * *************************************
 * Only in exceptional cases a FF should be 'true' by default.
 * Making a flag default to 'true' can lead to confusing and unexpected scenarios.
 * If you must set a flag default = true, whenever you remove that flag
 * that change should be released as a MAJOR, because it's a breaking change.
 */
var defaultMediaFeatureFlags = exports.defaultMediaFeatureFlags = {
  mediaInline: false
};

/**
 * Public accessor from components to fallback to defaults if flags not passed,
 * otherwise whatever product has set will be returned.
 *
 * To override locally for testing:
 * - `localStorage[flagName] = true` to enable locally,
 * - `delete localStorage[flagName]` to remove.
 *
 * (you will see a warning in console if override used)
 * */
function getMediaFeatureFlag(flagName, featureFlags) {
  return (0, _genericFeatureFlag.getGenericFeatureFlag)(flagName, defaultMediaFeatureFlags, featureFlags);
}