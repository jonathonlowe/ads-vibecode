"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useSearchQuery = useSearchQuery;
var _react = require("react");
var _url = require("@atlaskit/linking-common/url");
function useSearchQuery(state) {
  var _queryState$current;
  var queryState = (0, _react.useRef)(null);

  /*
   * When state contains a valid url AND is NOT selected from results, and the url was updated
   * from the textbox, queryState should be null to clear the items in plugin state.
   *
   * Checking `lastEditedBy` prevents the items being cleared when the tab is changed.
   */
  if ((0, _url.isSafeUrl)(state.url) && state.selectedIndex === -1 && !state.preventHidingRecents) {
    queryState.current = null;
  }

  /*
   * When state contains a search term e.g. Not a valid url return a query
   */
  if (((_queryState$current = queryState.current) === null || _queryState$current === void 0 ? void 0 : _queryState$current.query) !== state.url && !(0, _url.isSafeUrl)(state.url)) {
    queryState.current = {
      query: state.url
    };
  }

  /*
   * When state contains a valid url and is selected from the list
   * return current state to prevent triger a new plugin search
   */
  return queryState.current;
}