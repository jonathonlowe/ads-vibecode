"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createWidgetDecoration = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _state = require("@atlaskit/editor-prosemirror/state");
var _view = require("@atlaskit/editor-prosemirror/view");
var _colors = require("@atlaskit/theme/colors");
/**
 * @jsxRuntime classic
 * @jsx jsx
 */

var selectionMarkerHighlightStyles = {
  content: "''",
  position: 'absolute',
  backgroundImage: "url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMyIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDMgMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMSAxSDBMMSAxLjg1NzE0VjE4LjE0MzNMMCAxOS4wMDA0SDNMMiAxOC4xNDMzVjEuODU3MTRMMyAxSDJIMVoiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3QgeT0iMTkiIHdpZHRoPSIzIiBoZWlnaHQ9IjEiIGZpbGw9IiM1NzlERkYiLz4KPHJlY3Qgd2lkdGg9IjMiIGhlaWdodD0iMSIgZmlsbD0iIzU3OURGRiIvPgo8L3N2Zz4K')",
  top: "var(--ds-space-0, 0px)",
  bottom: "var(--ds-space-negative-025, -2px)",
  backgroundRepeat: 'no-repeat',
  backgroundPositionX: 'center',
  backgroundPositionY: 'center',
  backgroundSize: 'contain',
  aspectRatio: '3/20',
  left: '0px',
  marginLeft: "var(--ds-space-negative-025, -2px)",
  right: '0px',
  marginRight: "var(--ds-space-negative-025, -2px)",
  pointerEvents: 'none'
};
var selectionMarkerCursorStyles = {
  content: "''",
  position: 'absolute',
  background: "var(--ds-text, ".concat(_colors.N500, ")"),
  width: '1px',
  display: 'inline-block',
  top: "var(--ds-space-0, 0px)",
  bottom: "var(--ds-space-negative-025, -2px)",
  left: '1px',
  marginLeft: "var(--ds-space-negative-025, -2px)",
  right: '0px',
  marginRight: "var(--ds-space-negative-025, -2px)",
  pointerEvents: 'none'
};

/**
 * Converts a camelCased CSS property name to a hyphenated CSS property name.
 *
 * @param property - CamelCased CSS property name.
 * @returns Hyphenated CSS property name.
 */
function hyphenate(property) {
  // Ignored via go/ees005
  // eslint-disable-next-line require-unicode-regexp
  return property.replace(/[A-Z]/g, function (match) {
    return "-".concat(match.toLowerCase());
  }).replace(/^ms/, '-ms');
}
var Widget = function Widget(_ref) {
  var type = _ref.type,
    isHighlight = _ref.isHighlight;
  var span = document.createElement('span');
  var styles = isHighlight ? selectionMarkerHighlightStyles : selectionMarkerCursorStyles;
  for (var _i = 0, _Object$entries = Object.entries(styles); _i < _Object$entries.length; _i++) {
    var _Object$entries$_i = (0, _slicedToArray2.default)(_Object$entries[_i], 2),
      rule = _Object$entries$_i[0],
      value = _Object$entries$_i[1];
    span.style.setProperty(hyphenate(rule), value);
  }
  span.setAttribute('contentEditable', 'false');
  span.dataset.testid = "selection-marker-".concat(type, "-cursor");
  return span;
};
var toDOM = function toDOM(type, isHighlight) {
  var element = document.createElement('span');
  element.contentEditable = 'false';
  element.setAttribute('style', "position: relative;");
  element.appendChild(Widget({
    type: type,
    isHighlight: isHighlight
  }));
  return element;
};
var containsText = function containsText(resolvedPos) {
  var nodeBefore = resolvedPos.nodeBefore,
    nodeAfter = resolvedPos.nodeAfter;
  return (nodeBefore === null || nodeBefore === void 0 ? void 0 : nodeBefore.isInline) || (nodeAfter === null || nodeAfter === void 0 ? void 0 : nodeAfter.isInline);
};
var createWidgetDecoration = exports.createWidgetDecoration = function createWidgetDecoration(resolvedPos, type, selection, isHighlight) {
  // We don't want the cursor to show if it's not text selection
  // ie. if it's on media selection
  if (!(selection instanceof _state.TextSelection) || containsText(resolvedPos) === false || !selection.empty) {
    return [];
  }
  return [_view.Decoration.widget(resolvedPos.pos, toDOM(type, isHighlight), {
    side: -1,
    key: "".concat(type, "WidgetDecoration"),
    stopEvent: function stopEvent() {
      return true;
    },
    ignoreSelection: true
  })];
};