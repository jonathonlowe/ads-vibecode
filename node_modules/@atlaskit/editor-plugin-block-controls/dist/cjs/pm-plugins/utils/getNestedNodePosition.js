"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getNestedNodePosition = void 0;
var _state = require("@atlaskit/editor-prosemirror/state");
var _utils = require("@atlaskit/editor-prosemirror/utils");
var getNestedNodePosition = exports.getNestedNodePosition = function getNestedNodePosition(state) {
  var selection = state.selection;
  var nestedNodePos = selection.$from.before(1);
  if (selection instanceof _state.TextSelection) {
    nestedNodePos = selection.$from.before();
    var $pos = state.doc.resolve(nestedNodePos);
    if ($pos.depth < 1) {
      return nestedNodePos;
    }
    var parentNodeOfSpecificTypes = (0, _utils.findParentNodeOfType)([state.schema.nodes.bulletList, state.schema.nodes.orderedList, state.schema.nodes.blockquote, state.schema.nodes.taskList, state.schema.nodes.decisionList])(state.selection);
    if (parentNodeOfSpecificTypes) {
      var parentNodeType = parentNodeOfSpecificTypes.node.type.name;
      nestedNodePos = ['bulletList', 'orderedList'].includes(parentNodeType) ? $pos.before($pos.depth - 1) : ['blockquote', 'taskList', 'decisionList'].includes(parentNodeType) ? $pos.before() : nestedNodePos;
    }
  } else {
    nestedNodePos = selection.$from.pos;
  }
  return nestedNodePos;
};