import _defineProperty from "@babel/runtime/helpers/defineProperty";
import { bind } from 'bind-event-listener';
import { markProfilingEnd, markProfilingStart, withProfiling } from '../../../self-measurements';
export default class WindowEventObserver {
  constructor(opts) {
    _defineProperty(this, "unbindFns", []);
    const operationTimer = markProfilingStart('WindowEventObserver constructor');
    this.onEvent = withProfiling(opts.onEvent, ['vc']);
    this.bindEvent = withProfiling(this.bindEvent.bind(this), ['vc']);
    this.start = withProfiling(this.start.bind(this), ['vc']);
    this.stop = withProfiling(this.stop.bind(this), ['vc']);
    markProfilingEnd(operationTimer);
  }
  bindEvent(type) {
    const unbindCallback = bind(window, {
      type,
      listener: event => {
        if (!event.isTrusted) {
          return;
        }
        this.onEvent({
          time: event.timeStamp,
          type,
          event
        });
      },
      options: {
        passive: true,
        once: true
      }
    });
    this.unbindFns.push(unbindCallback);
  }
  start() {
    this.bindEvent('wheel');
    this.bindEvent('scroll');
    this.bindEvent('keydown');
    this.bindEvent('resize');
  }
  stop() {
    this.unbindFns.forEach(cb => {
      cb();
    });
    this.unbindFns = [];
  }
}