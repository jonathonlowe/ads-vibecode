"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _uuid = require("uuid");
var _coinflip = _interopRequireDefault(require("../coinflip"));
var _config = require("../config");
var _interactionIdContext = require("../interaction-id-context");
var _interactionMetrics = require("../interaction-metrics");
var _routeNameContext = _interopRequireDefault(require("../route-name-context"));
var _selfMeasurements = require("../self-measurements");
var mapToInteractionType = (0, _selfMeasurements.withProfiling)(function mapToInteractionType(eventType) {
  if (eventType === 'click' || eventType === 'dblclick' || eventType === 'mousedown') {
    return 'press';
  }
  if (eventType === 'mouseenter' || eventType === 'mouseover') {
    return 'hover';
  }
  return undefined;
});
var traceUFOInteraction = (0, _selfMeasurements.withProfiling)(function traceUFOInteraction(name, event) {
  if (!event || !event.isTrusted) {
    return;
  }
  var interactionType = mapToInteractionType(event.type);
  if (!interactionType) {
    // when interactionType is falsy we do not yet support this type of event. should we blow up with throwing error instead?
    return;
  }
  var rate = (0, _config.getInteractionRate)(name, interactionType);
  var pressInteractionsList = (0, _config.getDoNotAbortActivePressInteraction)();
  if (pressInteractionsList !== null && pressInteractionsList !== void 0 && pressInteractionsList.includes(name)) {
    var interaction = (0, _interactionMetrics.getActiveInteraction)();
    if ((interaction === null || interaction === void 0 ? void 0 : interaction.ufoName) !== 'unknown' && (interaction === null || interaction === void 0 ? void 0 : interaction.type) === 'press') {
      return;
    }
  }
  if ((0, _coinflip.default)(rate)) {
    var _event$timeStamp;
    (0, _interactionMetrics.abortAll)('new_interaction', name);
    var startTimestamp = (_event$timeStamp = event.timeStamp) !== null && _event$timeStamp !== void 0 ? _event$timeStamp : performance.now();
    var newId = (0, _uuid.v4)();
    _interactionIdContext.DefaultInteractionID.current = newId;
    (0, _interactionMetrics.addNewInteraction)(newId, name, 'press', startTimestamp, rate, [], _routeNameContext.default.current);
  }
});
var _default = exports.default = traceUFOInteraction;