"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getBundleEvalTimings = exports.configure = void 0;
var _roundNumber = require("../round-number");
var _selfMeasurements = require("../self-measurements");
var config = null;
var configure = exports.configure = (0, _selfMeasurements.withProfiling)(function configure(bundleEvalTimingConfiguration) {
  config = bundleEvalTimingConfiguration;
});
var getPerformanceObject = (0, _selfMeasurements.withProfiling)(function getPerformanceObject() {
  var _window;
  return ((_window = window) !== null && _window !== void 0 ? _window : {}).performance;
});
var getBundleEvalTimings = exports.getBundleEvalTimings = (0, _selfMeasurements.withProfiling)(function getBundleEvalTimings(interactionStartTime) {
  if (config == null) {
    return {};
  }
  var started = {};
  var timings = {};
  var cachedConfig = config;
  var performance = getPerformanceObject();
  performance === null || performance === void 0 || performance.getEntriesByType('mark').forEach(function (mark) {
    var result = cachedConfig.mapPerformanceMark(mark.name);
    if (!result) {
      return;
    }
    var type = result.type,
      name = result.name;
    if (type === 'start' && mark.startTime >= interactionStartTime) {
      started[name] = mark;
      return;
    }
    if (type === 'end' && started[name]) {
      timings[name] = {
        startTime: (0, _roundNumber.roundEpsilon)(started[name].startTime - interactionStartTime),
        duration: (0, _roundNumber.roundEpsilon)(mark.startTime - started[name].startTime)
      };
      delete started[name];
    }
  });
  if (Object.keys(timings).length === 0) {
    return {};
  }
  return timings;
});