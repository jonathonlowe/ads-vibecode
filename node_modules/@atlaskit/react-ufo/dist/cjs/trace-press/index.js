"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _uuid = require("uuid");
var _coinflip = _interopRequireDefault(require("../coinflip"));
var _config = require("../config");
var _experienceTraceIdContext = require("../experience-trace-id-context");
var _interactionIdContext = require("../interaction-id-context");
var _interactionMetrics = require("../interaction-metrics");
var _routeNameContext = _interopRequireDefault(require("../route-name-context"));
var _selfMeasurements = require("../self-measurements");
var traceUFOPress = (0, _selfMeasurements.withProfiling)(function traceUFOPress(name, timestamp) {
  var rate = (0, _config.getInteractionRate)(name, 'press');
  var pressInteractionsList = (0, _config.getDoNotAbortActivePressInteraction)();
  if (pressInteractionsList !== null && pressInteractionsList !== void 0 && pressInteractionsList.includes(name)) {
    var interaction = (0, _interactionMetrics.getActiveInteraction)();
    if ((interaction === null || interaction === void 0 ? void 0 : interaction.ufoName) !== 'unknown' && (interaction === null || interaction === void 0 ? void 0 : interaction.type) === 'press') {
      return;
    }
  }
  if ((0, _coinflip.default)(rate)) {
    (0, _interactionMetrics.abortAll)('new_interaction', name);
    var startTimestamp = timestamp !== null && timestamp !== void 0 ? timestamp : performance.now();
    var newId = (0, _uuid.v4)();
    // covered experiences with tracing instrumentation:
    // inline-result.inline-card-create-submit
    (0, _experienceTraceIdContext.setInteractionActiveTrace)(newId, 'press');
    _interactionIdContext.DefaultInteractionID.current = newId;
    (0, _interactionMetrics.addNewInteraction)(newId, name, 'press', startTimestamp, rate, [], _routeNameContext.default.current, (0, _experienceTraceIdContext.getActiveTrace)());
  }
});
var _default = exports.default = traceUFOPress;