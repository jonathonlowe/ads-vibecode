"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createEmojiNodeDataProvider = createEmojiNodeDataProvider;
var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _index = require("../index");
function createEmojiNodeDataProvider(_ref) {
  var emojiProvider = _ref.emojiProvider,
    existingCache = _ref.existingCache;
  var emojiNodeDataProvider = new _index.NodeDataProvider({
    existingCache: existingCache,
    nodeName: 'emoji',
    nodeToKey: function nodeToKey(node) {
      var key = "".concat(node.attrs.id, "-").concat(node.attrs.shortName, "-").concat(node.attrs.text);
      return key;
    },
    resolve: function resolve(node, _resolveOptions) {
      return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {
        var emojiDescriptionWithVariations;
        return _regenerator.default.wrap(function _callee$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return emojiProvider;
            case 2:
              _context.next = 4;
              return _context.sent.fetchByEmojiId({
                id: node.attrs.id,
                shortName: node.attrs.shortName,
                fallback: node.attrs.text
              }, true);
            case 4:
              emojiDescriptionWithVariations = _context.sent;
              if (emojiDescriptionWithVariations) {
                _context.next = 7;
                break;
              }
              throw new Error('Could not resolve emoji');
            case 7:
              return _context.abrupt("return", emojiDescriptionWithVariations);
            case 8:
            case "end":
              return _context.stop();
          }
        }, _callee);
      }))();
    }
  });
  return emojiNodeDataProvider;
}