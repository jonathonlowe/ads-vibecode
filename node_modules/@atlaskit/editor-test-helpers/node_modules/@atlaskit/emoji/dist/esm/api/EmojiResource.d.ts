import { AbstractResource, OnProviderChange, ServiceConfig } from '@atlaskit/util-service-support';
import { CategoryId } from '../components/picker/categories';
import { EmojiDescription, EmojiId, EmojiProvider, EmojiResponse, EmojiSearchResult, EmojiUpload, OptionalEmojiDescription, OptionalUser, SearchOptions, ToneSelection, UploadingEmojiProvider, User } from '../types';
import EmojiRepository from './EmojiRepository';
import SiteEmojiResource from './media/SiteEmojiResource';
export { EmojiProvider, UploadingEmojiProvider } from '../types';
export interface EmojiResourceConfig {
    /**
     * The service configuration for remotely recording emoji selections.
     * A post will be performed to this URL with the EmojiId as the body.
     */
    recordConfig?: ServiceConfig;
    /**
     * This defines the different providers. Later providers will override earlier
     * providers when performing shortName based look up.
     */
    providers: ServiceConfig[];
    /**
     * Must be set to true to enable upload support in the emoji components.
     *
     * Can be used for the restriction of the upload UI based on permissions, or feature flags.
     *
     * Note this also requires that other conditions are met (for example, one of the providers
     * must support upload for the UploadingEmojiResource implementation of UploadingEmojiProvider).
     */
    allowUpload?: boolean;
    /**
     * Logged user in the Product.
     */
    currentUser?: User;
}
export interface OnEmojiProviderChange extends OnProviderChange<EmojiSearchResult, any, void> {
}
export interface Retry<T> {
    (): Promise<T> | T;
}
export interface ResolveReject<T> {
    resolve(result: T): void;
    reject(reason?: any): void;
}
/**
 * Checks if the emojiProvider can support uploading at a feature level.
 *
 * Follow this up with an isUploadSupported() check to see if the provider is actually
 * configured to support uploads.
 */
export declare const supportsUploadFeature: (emojiProvider: EmojiProvider) => emojiProvider is UploadingEmojiProvider;
export interface LastQuery {
    query?: string;
    options?: SearchOptions;
}
export declare class EmojiResource extends AbstractResource<string, EmojiSearchResult, any, undefined, SearchOptions> implements EmojiProvider {
    protected recordConfig?: ServiceConfig;
    protected emojiRepository?: EmojiRepository;
    protected lastQuery?: LastQuery;
    protected activeLoaders: number;
    protected retries: Map<Retry<any>, ResolveReject<any>>;
    protected siteEmojiResource?: SiteEmojiResource;
    protected selectedTone: ToneSelection;
    protected currentUser?: User;
    constructor(config: EmojiResourceConfig);
    protected initEmojiRepository(emojiResponses: EmojiResponse[]): void;
    protected initSiteEmojiResource(emojiResponse: EmojiResponse, provider: ServiceConfig): Promise<void>;
    private performRetries;
    private loadStoredTone;
    protected refreshLastFilter(): void;
    protected isLoaded: () => false | EmojiRepository | undefined;
    protected retryIfLoading<T>(retry: Retry<T>, defaultResponse: T): Promise<T>;
    protected notifyResult(result: EmojiSearchResult): void;
    loadMediaEmoji(emoji: EmojiDescription, useAlt?: boolean): OptionalEmojiDescription | Promise<OptionalEmojiDescription>;
    optimisticMediaRendering(emoji: EmojiDescription, useAlt?: boolean): boolean;
    filter(query?: string, options?: SearchOptions): void;
    findByShortName(shortName: string): OptionalEmojiDescription | Promise<OptionalEmojiDescription>;
    findByEmojiId(emojiId: EmojiId): OptionalEmojiDescription | Promise<OptionalEmojiDescription>;
    findById(id: string): OptionalEmojiDescription | Promise<OptionalEmojiDescription>;
    findInCategory(categoryId: CategoryId): Promise<EmojiDescription[]>;
    getAsciiMap(): Promise<Map<string, EmojiDescription>>;
    getFrequentlyUsed(options?: SearchOptions): Promise<EmojiDescription[]>;
    /**
     * Record the selection of an emoji to a remote service if 'recordConfig' has been supplied.
     * Regardless of the recordConfig, emoji selections will always be recorded on the EmojiRepository
     * for the purposes of tracking the frequency of use.
     *
     * @param emoji The full description of the emoji to record usage for.
     */
    recordSelection(emoji: EmojiDescription): Promise<any>;
    deleteSiteEmoji(emoji: EmojiDescription): Promise<boolean>;
    getSelectedTone(): ToneSelection;
    setSelectedTone(tone: ToneSelection): void;
    calculateDynamicCategories(): Promise<CategoryId[]>;
    getCurrentUser(): OptionalUser;
    protected addUnknownEmoji(emoji: EmojiDescription): void;
}
export default class UploadingEmojiResource extends EmojiResource implements UploadingEmojiProvider {
    protected allowUpload: boolean;
    constructor(config: EmojiResourceConfig);
    isUploadSupported(): Promise<boolean>;
    uploadCustomEmoji(upload: EmojiUpload): Promise<EmojiDescription>;
    prepareForUpload(): Promise<void>;
}
