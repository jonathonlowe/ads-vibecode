"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var assertFieldHandlerLink = function (handlerLink) {
    if (!handlerLink.type) {
        throw new Error("Missing type!");
    }
};
var assertManifestFieldTypes = function (manifest, fieldType) {
    if (!manifest.modules.fields) {
        throw new Error("No definition of fields for extension type \"" + manifest.type + "\" and key \"" + manifest.key + "\"!");
    }
    if (!manifest.modules.fields[fieldType]) {
        throw new Error("No definition for field type \"" + fieldType + "\" on manifest for extension with type \"" + manifest.type + "\" and key \"" + manifest.key + "\"!");
    }
};
function getExtensionModuleField(manifest, fieldType, handlerLink) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var type, handler;
        return tslib_1.__generator(this, function (_a) {
            assertFieldHandlerLink(handlerLink);
            assertManifestFieldTypes(manifest, fieldType);
            type = handlerLink.type;
            handler = manifest.modules.fields[fieldType][type];
            if (!handler) {
                throw new Error("No handler of type \"" + type + "\" for extension type \"" + manifest.type + "\" and key \"" + manifest.key + "\"!");
            }
            return [2 /*return*/, handler];
        });
    });
}
function getFieldResolver(manifest, handlerLink) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var customFieldHandler;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, getExtensionModuleField(manifest, 'custom', handlerLink)];
                case 1:
                    customFieldHandler = _a.sent();
                    return [2 /*return*/, customFieldHandler.resolver];
            }
        });
    });
}
exports.getFieldResolver = getFieldResolver;
function getFieldSerializer(manifest, handlerLink) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var fieldsetHandler;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, getExtensionModuleField(manifest, 'fieldset', handlerLink)];
                case 1:
                    fieldsetHandler = _a.sent();
                    return [2 /*return*/, fieldsetHandler.serializer];
            }
        });
    });
}
exports.getFieldSerializer = getFieldSerializer;
function getFieldDeserializer(manifest, handlerLink) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var fieldsetHandler;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, getExtensionModuleField(manifest, 'fieldset', handlerLink)];
                case 1:
                    fieldsetHandler = _a.sent();
                    return [2 /*return*/, fieldsetHandler.deserializer];
            }
        });
    });
}
exports.getFieldDeserializer = getFieldDeserializer;
//# sourceMappingURL=extension-fields-helpers.js.map