import { SafePlugin } from '@atlaskit/editor-common/safe-plugin';
import { pluginKey } from './plugin-key';
export function createPlugin(dispatch, imageEnabled) {
  return new SafePlugin({
    key: pluginKey,
    state: {
      init() {
        return {
          isVisible: false,
          imageEnabled
        };
      },
      apply(tr, _value, state) {
        const isVisible = tr.getMeta(pluginKey);
        const currentState = pluginKey.getState(state);
        if (isVisible !== undefined && isVisible !== currentState.isVisible) {
          const newState = {
            ...currentState,
            isVisible
          };
          dispatch(pluginKey, newState);
          return newState;
        }
        return currentState;
      }
    }
  });
}