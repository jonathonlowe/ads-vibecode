"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createDeferred = void 0;
const createDeferred = ({
  loader,
  preload
}) => {
  let resolve;
  const deferred = {
    promise: new Promise(res => {
      resolve = m => {
        let withDefault;
        deferred.result = m;
        if (!m.default) {
          withDefault = {
            default: m
          };
        }
        res(withDefault ? withDefault : m);
      };
    }),
    result: undefined,
    preload: () => {
      if (deferred.result) {
        return;
      }
      preload().then(m => {
        deferred.result = m;
      }).catch(() => {
        // Do nothing...
      });
    },
    start: () => {
      if (deferred.result) {
        resolve(deferred.result);
        return Promise.resolve();
      }

      // Make a new loader request when none have started or resolved yet
      return loader().then(resolve);
    }
  };
  return deferred;
};
exports.createDeferred = createDeferred;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVEZWZlcnJlZCIsImxvYWRlciIsInByZWxvYWQiLCJyZXNvbHZlIiwiZGVmZXJyZWQiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlcyIsIm0iLCJ3aXRoRGVmYXVsdCIsInJlc3VsdCIsImRlZmF1bHQiLCJ1bmRlZmluZWQiLCJ0aGVuIiwiY2F0Y2giLCJzdGFydCIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGF6eS9kZWZlcnJlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgQ2xpZW50TG9hZGVyLCBKYXZhU2NyaXB0TW9kdWxlIH0gZnJvbSAnLi9sb2FkZXInO1xuXG5leHBvcnQgdHlwZSBDcmVhdGVEZWZlcnJlZE9wdGlvbnM8Qz4gPSB7XG4gIGxvYWRlcjogQ2xpZW50TG9hZGVyPEM+O1xuICBwcmVsb2FkOiBDbGllbnRMb2FkZXI8Qz47XG59O1xuXG5leHBvcnQgdHlwZSBEZWZlcnJlZDxDPiA9IHtcbiAgcHJlbG9hZCgpOiB2b2lkO1xuICBwcm9taXNlOiBQcm9taXNlPEphdmFTY3JpcHRNb2R1bGU8Qz4+O1xuICByZXN1bHQ6IEphdmFTY3JpcHRNb2R1bGU8Qz4gfCB2b2lkO1xuICBzdGFydCgpOiBQcm9taXNlPHZvaWQ+O1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZURlZmVycmVkID0gPEMgZXh0ZW5kcyBDb21wb25lbnRUeXBlPGFueT4+KHtcbiAgbG9hZGVyLFxuICBwcmVsb2FkLFxufTogQ3JlYXRlRGVmZXJyZWRPcHRpb25zPEM+KTogRGVmZXJyZWQ8Qz4gPT4ge1xuICBsZXQgcmVzb2x2ZTogKG06IGFueSkgPT4gdm9pZDtcblxuICBjb25zdCBkZWZlcnJlZCA9IHtcbiAgICBwcm9taXNlOiBuZXcgUHJvbWlzZTxKYXZhU2NyaXB0TW9kdWxlPEM+PihyZXMgPT4ge1xuICAgICAgcmVzb2x2ZSA9IChtOiBhbnkpID0+IHtcbiAgICAgICAgbGV0IHdpdGhEZWZhdWx0O1xuICAgICAgICBkZWZlcnJlZC5yZXN1bHQgPSBtO1xuXG4gICAgICAgIGlmICghbS5kZWZhdWx0KSB7XG4gICAgICAgICAgd2l0aERlZmF1bHQgPSB7IGRlZmF1bHQ6IG0gfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlcyh3aXRoRGVmYXVsdCA/IHdpdGhEZWZhdWx0IDogbSk7XG4gICAgICB9O1xuICAgIH0pLFxuICAgIHJlc3VsdDogdW5kZWZpbmVkLFxuICAgIHByZWxvYWQ6ICgpID0+IHtcbiAgICAgIGlmIChkZWZlcnJlZC5yZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBwcmVsb2FkKClcbiAgICAgICAgLnRoZW4oKG06IGFueSkgPT4ge1xuICAgICAgICAgIGRlZmVycmVkLnJlc3VsdCA9IG07XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgLy8gRG8gbm90aGluZy4uLlxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIHN0YXJ0OiAoKSA9PiB7XG4gICAgICBpZiAoZGVmZXJyZWQucmVzdWx0KSB7XG4gICAgICAgIHJlc29sdmUoZGVmZXJyZWQucmVzdWx0KTtcblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1ha2UgYSBuZXcgbG9hZGVyIHJlcXVlc3Qgd2hlbiBub25lIGhhdmUgc3RhcnRlZCBvciByZXNvbHZlZCB5ZXRcbiAgICAgIHJldHVybiBsb2FkZXIoKS50aGVuKHJlc29sdmUpO1xuICAgIH0sXG4gIH07XG5cbiAgcmV0dXJuIGRlZmVycmVkO1xufTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBZU8sTUFBTUEsY0FBYyxHQUFHQSxDQUErQjtFQUMzREMsTUFBTTtFQUNOQztBQUN3QixDQUFDLEtBQWtCO0VBQzNDLElBQUlDLE9BQXlCO0VBRTdCLE1BQU1DLFFBQVEsR0FBRztJQUNmQyxPQUFPLEVBQUUsSUFBSUMsT0FBTyxDQUFzQkMsR0FBRyxJQUFJO01BQy9DSixPQUFPLEdBQUlLLENBQU0sSUFBSztRQUNwQixJQUFJQyxXQUFXO1FBQ2ZMLFFBQVEsQ0FBQ00sTUFBTSxHQUFHRixDQUFDO1FBRW5CLElBQUksQ0FBQ0EsQ0FBQyxDQUFDRyxPQUFPLEVBQUU7VUFDZEYsV0FBVyxHQUFHO1lBQUVFLE9BQU8sRUFBRUg7VUFBRSxDQUFDO1FBQzlCO1FBRUFELEdBQUcsQ0FBQ0UsV0FBVyxHQUFHQSxXQUFXLEdBQUdELENBQUMsQ0FBQztNQUNwQyxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0lBQ0ZFLE1BQU0sRUFBRUUsU0FBUztJQUNqQlYsT0FBTyxFQUFFQSxDQUFBLEtBQU07TUFDYixJQUFJRSxRQUFRLENBQUNNLE1BQU0sRUFBRTtRQUNuQjtNQUNGO01BRUFSLE9BQU8sQ0FBQyxDQUFDLENBQ05XLElBQUksQ0FBRUwsQ0FBTSxJQUFLO1FBQ2hCSixRQUFRLENBQUNNLE1BQU0sR0FBR0YsQ0FBQztNQUNyQixDQUFDLENBQUMsQ0FDRE0sS0FBSyxDQUFDLE1BQU07UUFDWDtNQUFBLENBQ0QsQ0FBQztJQUNOLENBQUM7SUFDREMsS0FBSyxFQUFFQSxDQUFBLEtBQU07TUFDWCxJQUFJWCxRQUFRLENBQUNNLE1BQU0sRUFBRTtRQUNuQlAsT0FBTyxDQUFDQyxRQUFRLENBQUNNLE1BQU0sQ0FBQztRQUV4QixPQUFPSixPQUFPLENBQUNILE9BQU8sQ0FBQyxDQUFDO01BQzFCOztNQUVBO01BQ0EsT0FBT0YsTUFBTSxDQUFDLENBQUMsQ0FBQ1ksSUFBSSxDQUFDVixPQUFPLENBQUM7SUFDL0I7RUFDRixDQUFDO0VBRUQsT0FBT0MsUUFBUTtBQUNqQixDQUFDO0FBQUNZLE9BQUEsQ0FBQWhCLGNBQUEsR0FBQUEsY0FBQSIsImlnbm9yZUxpc3QiOltdfQ==