"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useSubscription = useSubscription;
var _react = require("react");
function useSubscription({
  context,
  load,
  onValue
}) {
  const {
    subscribe,
    currentValue
  } = (0, _react.useContext)(context);
  (0, _react.useMemo)(() => {
    let unsubscribe = null;
    const check = () => {
      const done = onValue(currentValue());
      if (done) load();
      if (done && unsubscribe) unsubscribe();
      return done;
    };
    unsubscribe = !check() ? subscribe(check) : null;
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwidXNlU3Vic2NyaXB0aW9uIiwiY29udGV4dCIsImxvYWQiLCJvblZhbHVlIiwic3Vic2NyaWJlIiwiY3VycmVudFZhbHVlIiwidXNlQ29udGV4dCIsInVzZU1lbW8iLCJ1bnN1YnNjcmliZSIsImNoZWNrIiwiZG9uZSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9sYXp5L2NvbXBvbmVudHMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlQ29udGV4dCwgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB0eXBlIHsgQ29udGV4dCB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHR5cGUgeyBTdWJzY3JpcHRpb25Db250ZXh0VmFsdWUgfSBmcm9tICcuLi90eXBlcyc7XG5cbnR5cGUgVXNlU3Vic2NyaXB0aW9uQXJnczxDPiA9IHtcbiAgY29udGV4dDogQ29udGV4dDxDPjtcbiAgbG9hZDogKCkgPT4gdm9pZDtcbiAgb25WYWx1ZTogKHY6IG51bWJlcikgPT4gYm9vbGVhbjtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VTdWJzY3JpcHRpb248QyBleHRlbmRzIFN1YnNjcmlwdGlvbkNvbnRleHRWYWx1ZT4oe1xuICBjb250ZXh0LFxuICBsb2FkLFxuICBvblZhbHVlLFxufTogVXNlU3Vic2NyaXB0aW9uQXJnczxDPikge1xuICBjb25zdCB7IHN1YnNjcmliZSwgY3VycmVudFZhbHVlIH0gPSB1c2VDb250ZXh0KGNvbnRleHQpO1xuICB1c2VNZW1vKCgpID0+IHtcbiAgICBsZXQgdW5zdWJzY3JpYmU6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuICAgIGNvbnN0IGNoZWNrID0gKCkgPT4ge1xuICAgICAgY29uc3QgZG9uZSA9IG9uVmFsdWUoY3VycmVudFZhbHVlKCkpO1xuICAgICAgaWYgKGRvbmUpIGxvYWQoKTtcbiAgICAgIGlmIChkb25lICYmIHVuc3Vic2NyaWJlKSB1bnN1YnNjcmliZSgpO1xuXG4gICAgICByZXR1cm4gZG9uZTtcbiAgICB9O1xuXG4gICAgdW5zdWJzY3JpYmUgPSAhY2hlY2soKSA/IHN1YnNjcmliZShjaGVjaykgOiBudWxsO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW10pO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFXTyxTQUFTQyxlQUFlQSxDQUFxQztFQUNsRUMsT0FBTztFQUNQQyxJQUFJO0VBQ0pDO0FBQ3NCLENBQUMsRUFBRTtFQUN6QixNQUFNO0lBQUVDLFNBQVM7SUFBRUM7RUFBYSxDQUFDLEdBQUcsSUFBQUMsaUJBQVUsRUFBQ0wsT0FBTyxDQUFDO0VBQ3ZELElBQUFNLGNBQU8sRUFBQyxNQUFNO0lBQ1osSUFBSUMsV0FBZ0MsR0FBRyxJQUFJO0lBQzNDLE1BQU1DLEtBQUssR0FBR0EsQ0FBQSxLQUFNO01BQ2xCLE1BQU1DLElBQUksR0FBR1AsT0FBTyxDQUFDRSxZQUFZLENBQUMsQ0FBQyxDQUFDO01BQ3BDLElBQUlLLElBQUksRUFBRVIsSUFBSSxDQUFDLENBQUM7TUFDaEIsSUFBSVEsSUFBSSxJQUFJRixXQUFXLEVBQUVBLFdBQVcsQ0FBQyxDQUFDO01BRXRDLE9BQU9FLElBQUk7SUFDYixDQUFDO0lBRURGLFdBQVcsR0FBRyxDQUFDQyxLQUFLLENBQUMsQ0FBQyxHQUFHTCxTQUFTLENBQUNLLEtBQUssQ0FBQyxHQUFHLElBQUk7SUFDaEQ7RUFDRixDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQ1IiLCJpZ25vcmVMaXN0IjpbXX0=